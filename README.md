# Telegram-бот для отслеживания обновлений контента по ссылкам

## УЧАСТНИКИ ПРОЕКТА  
Олейникова Анастасия Денисовна 5130202/20201  
Щербинина Дарья Вячеславовна 5130202/20201

## ЭТАПЫ
### ОПРЕДЕЛЕНИЕ ПРОБЛЕМЫ
Некоторые важные для IT-специалиста сайты, например, GitHub и StackOverflow,
не имеют системы уведомлений, соответствующей современным критериям удобства.
Пользователь вынужден регулярно вручную проверять каждую веб-страницу
по-отдельности, чтобы отследить изменения, что неудобно, времязатратно
и увеличивает вероятность пропустить изменения.

### ВЫРАБОТКА ТРЕБОВАНИЙ
Действующие лица:
1.	Пользователь.  

Варианты использования:
1.	Зарегистрироваться;
2.	Просмотреть перечень команд;
3.	Добавить ссылку для отслеживания;
4.	Удалить ссылку для отслеживания;
5.	Просмотреть перечень отслеживаемых ссылок.

![USE CASE диаграмма](use_case.png)

Сценарии вариантов использования:

I) **Зарегистрироваться**.  
Основное действующее лицо: пользователь.  
Триггер: пользователь ввел команду /start.  
Гарантия успеха: пользователь зарегистрировался в системе.  
Основной сценарий:
1.	Система регистрирует пользователя;
2.	Система отправляет приветственное сообщение,
сигнализируя об успешном завершении регистрации и готовности к работе.  

Расширения: отсутствуют.

II)	**Просмотреть перечень команд**.  
Основное действующее лицо: пользователь.  
Триггер: пользователь ввел команду /help.  
Гарантия успеха: пользователь получил сообщение с перечнем команд.  
Основной сценарий:
1.	Система отправляет сообщение с перечнем команд.

Расширения: отсутствуют.

III) **Добавить ссылку для отслеживания**.  
Основное действующее лицо: пользователь.  
Триггер: пользователь ввел команду /track в формате /track <ссылка>.  
Гарантия успеха: пользователь получил сообщение о начале отслеживания ссылки,
ссылка появилась в перечне отслеживаемых ссылок.  
Основной сценарий:
1.	Система начинает отслеживать данную ссылку;
2.	Система отправляет сообщение о начале отслеживания ссылки.

Расширения:  
1.а. Данная ссылка ведет на не определенный в системе ресурс;  
    1.а.1. Система отправляет сообщение о некорректности ссылки
    и предлагает пользователю проверить ссылку и попробовать еще раз;  
1.б. Данная ссылка уже отслеживается;  
    1.б.1. Система отправляет сообщение о том, что ссылка уже отслеживается.

IV)	**Удалить ссылку для отслеживания**.  
Основное действующее лицо: пользователь.  
Триггер: пользователь ввел команду /untrack в формате /untrack <ссылка>.  
Гарантия успеха: пользователь получил сообщение о прекращении отслеживания ссылки,
ссылка исчезла из перечня отслеживаемых ссылок.  
Основной сценарий:  
1.	Система прекращает отслеживать данную ссылку;
2.	Система отправляет сообщение о прекращении отслеживания ссылки.

Расширения:  
1.а. Данная ссылка не отслеживалась ранее;  
1.а.1. Система отправляет сообщение о некорректности ссылки
и предлагает пользователю проверить ссылку и попробовать еще раз.

V) **Просмотреть перечень отслеживаемых ссылок**.  
Основное действующее лицо: пользователь.  
Триггер: пользователь ввел команду /list.  
Гарантия успеха: пользователь получил сообщение с перечнем отслеживаемых ссылок.  
Основной сценарий:
1.	Система отправляет сообщение с перечнем отслеживаемых ссылок.

Расширения:  
1.а. Перечень отслеживаемых ссылок пуст;  
1.а.1. Система отправляет сообщение о том, что список отслеживаемых ссылок пуст.

### РАЗРАБОТКА АРХИТЕКТУРЫ И ДЕТАЛЬНОЕ ПРОЕКТИРОВАНИЕ
#### Характер нагрузки на сервис
Соотношение R/W нагрузки:  
- Read: ~70% (проверка обновлений, чтение ссылок из БД);  
- Write: ~30% (регистрация, добавление/удаление ссылок,
обновление временных меток, рассылка уведомлений).

Объемы трафика:  
~10 000 пользователей; каждый пользователь отслеживает ~10 ссылок =>  
- ~100 000 запросов/сутки (Scrapper → GitHub/StackOverflow);  
- ~5 000–10 000 сообщений/сутки (Bot → Telegram API).

Объемы дисковой системы:  
- chat: до 10 000 записей
- link: до 100 000 уникальных ссылок
- chat_link: до 100 000 записей

=> Оценочный объём хранимых данных: ~1 ГБ за 5 лет

#### Диаграммы по C4-модели
Диаграмма контекста:
![с4_context.png](%D1%814_context.png)
Диаграмма контейнеров:  
![C4 Диаграмма контейнеров](%D1%814_container.png)

#### Контракты API
Примеры операций:  
/start: регистрация пользователя  
/track \<link\>: добавление ссылки  
/untrack \<link\>: удаление ссылки  
/list: просмотр отслеживаемых ссылок

Обмен сообщениями происходит через Telegram API и HTTP-взаимодействия между
BotService и ScrapperService.

Полный сценарий взаимодействий приведён в sequence-диаграмме:
![Sequence-диаграмма для основных команд](sequence_commands.png)
![Sequence-диаграмма для обновлений](sequence_updates.png)

#### Нефункциональные требования
Время отклика:  
<200 мс — для взаимодействия пользователя с ботом  
<1 c — для асинхронных HTTP-запросов между сервисами

Надежность: поддержка повторных попыток в ScrapperClient и BotClient  
Масштабируемость: горизонтальная масштабируемость всех компонентов  
Устойчивость: retry-механизмы + логирование и мониторинг

#### Схема базы данных
- chat:  
bigint id (PK)  
- link:  
bigint id (PK),  
text url,  
timestamp with time zone last_update,  
timestamp with time zone checked_at  
- chat_link:  
bigint chat_id (FK),  
bigint link_id (FK)

Каждый пользователь может отслеживать до 10 ссылок. Схема обеспечивает:  
Быстрый доступ к данным через индексы;  
Минимизацию дублирования ссылок (многие ко многим);  
Эффективную проверку новых обновлений.

#### Масштабирование при росте нагрузки в 10 раз
BotService и ScrapperService: запуск в k8s/Docker Swarm с автоматическим
масштабированием;  
PostgreSQL: использование read-replicas;
индексирование, партиционирование таблиц;  
Kafka: очередь уведомлений для обеспечения асинхронной доставки;  
Update Scheduler: распараллеливание задач по временным слотам.

### UNIT ТЕСТИРОВАНИЕ



### ИНТЕГРАЦИОННОЕ ТЕСТИРОВАНИЕ



### СБОРКА